set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables
set +x # display each command as is run

# Detect # of CPUs so make jobs can be parallelized
CPUS=`grep -c ^processor /proc/cpuinfo`

# Golang package must be a dependency
export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=${GOROOT}/bin:$PATH

mkdir -p ${BOSH_COMPILE_TARGET}/gocode/src/github.com/docker
export GOPATH=${BOSH_COMPILE_TARGET}/agent:${BOSH_COMPILE_TARGET}/agent/src/github.com/cloudfoundry-community/bosh-pipeline-dashboard/Godeps/_workspace

cd ${BOSH_COMPILE_TARGET}/agent/src/github.com/cloudfoundry-community/bosh-pipeline-dashboard
go install -v -a

mkdir -p ${BOSH_INSTALL_TARGET}/bin
cp -a ${BOSH_COMPILE_TARGET}/agent/bin/* ${BOSH_INSTALL_TARGET}/bin
